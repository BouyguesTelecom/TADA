name: CI Docker and Helm

on:
    push:
        branches:
            - main

env:
    IMAGE_NAME: amelieloulou/transform-and-deliver-assets
    CHART_PATH: ./opensource

jobs:
    build-and-push-docker:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v3

            - name: Set up Docker Buildx
              uses: docker/setup-buildx-action@v2

            - name: Log in to Docker Hub
              uses: docker/login-action@v3
              with:
                  username: ${{ secrets.DOCKER_USERNAME }}
                  password: ${{ secrets.DOCKER_PASSWORD }}

            - name: Build and push Docker image API
              uses: docker/build-push-action@v5
              with:
                  context: ./src/api
                  push: true
                  tags: ${{ env.IMAGE_NAME }}:latest
            -   name: Build and push Docker image job
                uses: docker/build-push-action@v5
                with:
                    context: ./src
                    push: true
                    tags: ${{ env.IMAGE_NAME }}:job-latest